
%: cwd -> {lib//swirl//}
%: -> {'
   %: `::cwd'//init.swirl.0.1
`}

%::new_rule {}

%: -> {'
   %: `::cwd'//lean_comments.swirl
   %: `::cwd'//metatime.swirl
`}

%: {::bake_rule(until_bar = until |)}

%: eq(::until_bar|::rest) {} -> {false}
%: eq(:a:until_bar|:a) {} -> {true}

%: expect(false:r:rest) {} -> {
   %: -> {
      %: {{'::throw_`}:r}
   }
}
%: expect(true::rest) {} -> {}

%: negate('false`) -> {true}
%: negate('true`) -> {false}

%: {::use_whitespace_handler(remove all whitespace)} {
   %::test_rule_5(::rest) -> {error!}
   %: test_rule_5(this is a test) -> {this is the result}
}

%::test_rule_6(::rest) -> {error!}
%: test_rule_6(this is a test) -> {this is the result}

%: {::expect(::eq(::test_rule_5(thisisatest)|thisistheresult))}
%: {::expect(::eq(::test_rule_5(this is a test)|error!))}

%: {::expect(::eq(::test_rule_6(this is a test)|this is the result))}
%: {::expect(::eq(::test_rule_6(this  is  a  test)|this is the result))}
%: {::expect(::eq(::test_rule_6(thisisatest)|error!))}

%: {::swirl_rule_invoc} -> {} :rule:invoc
%: {::swirl_header({})!} -> {} {:hello:world this is a 'header`}!
%: {::swirl_rule_def} -> {} %: (flag) consumed_rule -> {'lmao}`} (catch unknown rule) {{''`}}
%: test_consumption (not) {::consumed_rule}
%: {::test_consumption}

%: -> {'
`  ::expect(true)'
`  ::expect(::negate(false))'
`  ::expect(::negate(::eq(hello|bye)))'
`  ::expect(::eq(same|same))'
`}

%: one {} -> {1}

%: {
   :y:one
   :x:copy(::one'_`:y'_`1)
} -> {
   ::expect(::eq(:x|1_1_1))
}

%: test_rule {}

%: meta! {'
   assert true or throw 2.
   assert not false or throw 3.
   assert not (true and (false and false)) or throw 4.
   assert rule test_rule exists or throw 5.
   create namespace test_namespaceee with tag test_tag.
   assert namespace test_namespaceee exists or throw 6.
   assert namespace test_namespaceee has tag test_tag or throw 7.
   assert not namespace test_namespaceee has tag some_other_tag or throw 8.

   raw '%: test_rule_2 {}`.
   assert rule test_rule_2 exists or throw 9.

   string test = "hello".
   string test = "bye".
   raw '%: {::expect(::eq(::test|bye)_111)}`.
   append " bye" to string test.
   raw '%: {::expect(::eq(::test|bye bye))}`.
   string other = string test.
   raw '%: {::expect(::eq(::other|::test)_not_equal_7638)}`.
`}

%: test_syntax {%: hello!} -> {%: result {} -> {true}}
%: {::activate_rule(test_syntax)}

%: result (clear) {}
%: hello!
%: {::expect(::result)}
/
    %-: c_quote {"::c_quote_inner"}
    %-: c_quote_inner {}
    %-: c_quote_inner {::not_quote_char::c_quote_inner_1::c_quote_inner}
    %-: c_quote_inner_1 {::anychar}
    %-: c_quote_inner_1 {\:c:anychar} -> {:c}
    %-: not_quote_char (not) {"}
/
%: {::line_rest} -> {} %:{::throw_test_line_rest_failed}

%: -> {
   %: ::cwd//experimental//structured.swirl
}


